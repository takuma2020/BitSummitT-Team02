using System.Collections;
using System.Collections.Generic;
using UnityEditor;
using UnityEngine;
using UnityEngine.UI;

/* 画面サイズで真っ黒なUIオブジェクトにアタッチする */
[RequireComponent(typeof(Image))]
public class Fade : MonoBehaviour
{
    private Image fadeImage;                // 透明度を変更するパネルのイメージ
    private float red, green, blue, alfa;   // パネルの色、不透明度を管理
    private float fadeSpeed = 0.02f;        // 透明度が変わるスピードを管理
    private bool isFadeOutScreen = false;   // フェードアウト処理の開始、完了を管理するフラグ
    private bool isFadeInScreen = false;    // フェードイン処理の開始、完了を管理するフラグ

    private void Start()
    {
        fadeImage = this.GetComponent<Image>();
        red = fadeImage.color.r;
        green = fadeImage.color.g;
        blue = fadeImage.color.b;
        alfa = fadeImage.color.a;
    }
    private void Update()
    {
        if (isFadeInScreen)
        {
            StartFadeIn();
        }

        if (isFadeOutScreen)
        {
            StartFadeOut();
        }
    }

    private void StartFadeIn()
    {
        alfa -= fadeSpeed;                  // 不透明度を徐々に下げる
        SetAlpha();                         // 変更した不透明度パネルに反映する

        // 完全に透明になったら処理を抜ける
        if (alfa <= 0.0f)
        {
            isFadeInScreen = false;
            fadeImage.enabled = false;      // パネルの表示をオフにする
        }
    }
    private void StartFadeOut()
    {
        fadeImage.enabled = true;           // パネルの表示をオンにする
        alfa += fadeSpeed;                  // 不透明度を徐々にあげる
        SetAlpha();                         // 変更した透明度をパネルに反映する

        // 完全に不透明になったら処理を抜ける
        if (alfa >= 1.0f)
        {
            isFadeOutScreen = false;
        }
    }
    private void SetAlpha()
    {
        fadeImage.color = new Color(red, green, blue, alfa);
    }
}